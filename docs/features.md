# JustMemo 功能模块与体验 (UX)

*   采用 **三栏响应式布局**：
    *   **左侧**: 固定导航、热力图、标签云。
    *   **中间**: 内容流与发布框。
    *   **右侧**: 时间/月份轴导航。

## 2. 左侧侧边栏 (Fixed)
*   **平滑收缩 (Smooth Transition)**：侧边栏折叠/展开时，通过 CSS 动画实现文字标签与底部功能区的平滑渐显/渐隐，优化视觉反馈。
*   **贡献热力图**: 
    *   展示一年内记录频率。
    *   Hover 交互：显示具体日期与发帖计数（如：“2025-05-20: 记录了 5 条 BB”）。
    *   **边缘对齐 (Edge-aware)**：Tooltip 会根据单元格在容器中的位置自动切换对齐方式（左对齐、居中、右对齐），防止在侧边栏边缘被截断。
    *   **交互拦截**：无记录日期禁用了 Click 和 Hover 缩放反馈，防止无效交互。
*   **标签云 (Tag Cloud)**: 
    *   基于正则提取内容中 `#标签`。
    *   支持点击过滤。
*   **去年今日 (Flashback)**: 
    *   自动回溯往年历史记录。
*   **主题切换 (Theme Toggle)**:
    *   入口: 侧边栏底部。
    *   模式: 循环切换 (浅色 -> 深色 -> 自动)。
*   **画廊模式 (Gallery Mode)**:
    *   **开关**: 位于左侧边栏。
    *   **视图**: 点击后进入 **网格视图 (Grid View)**，仅展示包含多媒体 URL 的卡片，或直接瀑布流展示图片缩略图。

## 3. 右侧区域 (Fixed)
*   **时间/月份轴 (Navigation Archive)**:
    *   **位置**: 位于页面最右侧。
    *   **UI**: 垂直方向的时间线/刻度。
    *   **交互**: 自动按年-月归档，点击对应月份瞬间滚动定位或重新加载该时段数据。

## 4. 中间主区域 (Scroll)
*   **极简发布框**: 
    *   **字数统计**: 实时显示当前输入内容的字数。
    *   快捷键：支持 `Ctrl/Cmd + Enter` 快速发送。
    *   多媒体支持：**仅限 URL 输入**。系统支持 **Markdown 格式解析**，自动识别 R2 图片直链及多语言代码块（Code Blocks），不支持文件/图片拖拽上传。
    *   **标签系统 (Tagging Logic)**:
        *   **录入模式**: 放弃从正文正则提取。在输入框下方设有独立的标签展示与录入区。
        *   **联想补全**: 输入时自动匹配已有标签列表，防止录入冗余或遗忘。
        *   **正文保持**: 发送时不对正文内容进行任何 `#` 符号的剔除或清洗，保持记录的原始状态。
        *   **存储**: 正文存入 `content`，选中的唯一标签集合存入 `tags` (Array)。
*   **数据导出 (仅管理员可见)**:
    *   **功能**: 支持一键导出所有记录。
    *   **格式**: 提供 **Markdown** (适合阅读) 和 **JSON** (适合备份) 两种格式选择。
    *   **入口**: 位于侧边栏设置区域。
*   **内容渲染 (Rendering)**:
    *   **Markdown**: 使用 `react-markdown` 或 `shiki` 进行解析。
    *   **代码高亮**: 深度适配主题，支持行号显示与一键复制代码。
*   **内容流**: 
    *   布局：采用 **瀑布流 (Waterfall/Masonry)** 布局。
    *   排序：**置顶内容 (Pinned)** 始终处于顶部，其余按 `created_at`倒序。
    *   **渐进式加载 (Progressive Loading)**: 
        *   **首屏**: SSR 直出最新 20 条记录，确保秒开。
        *   **全量**: 随后后台静默加载历史全量数据，并同步至本地 **LocalStorage**。
        *   **体验**: 二次访问时直接读取本地缓存，实现 **0 延迟** 展示。
    *   加载：Next.js 15 Streaming + **骨架屏 (Skeleton Screens)**。
*   **关联引用 (Referencing)**:
    *   **语法**: 输入 `@` 触发记录建议列表（支持编号与正文全文即时检索），选中后插入标准化的 `@编号` 文本。渲染层通过正则 `@(\d+)` 进行识别。
    *   **高性能索引**: 
        *   **即时响应 (Instant Load)**: 基于客户端内存缓存 (`MemoCache`) 与本地持久化存储 (`localStorage`)。
        *   **离线可用**: 全量数据加载完成后，**搜索与筛选** (Search & Filter) 转为纯客户端行为，无网络请求，瞬间响应。
        *   **智能摘要 (Smart Snippet)**: 搜索结果自动截取关键词前后的上下文（如：...foo [bar] baz...），而非固定的开头文本。
    *   **交互**: 
        *   **悬浮**: 鼠标移动至引用编号上时，弹出 **Popover** 显示所引用的 BB 正文预览。
        *   **反向链接**: 卡片底部展示引用了该记录的其他 BB（计划中）。
*   **卡片分享 (Share)**:
    *   **操作**: 卡片上提供“分享”按钮。
    *   **模式 A (链接)**: 复制该 BB 的独立详情页 URL。
    *   **模式 B (图片/海报)**: 
        *   生成渲染精美的图片海报。
        *   **QR 码**: 图片右下角自动生成指向该 BB 详情页的二维码。
        *   **保存**: 支持一键保存到本地或调用系统分享。
*   **管理操作 (仅管理员登录可见)**:
    *   **入口**: 悬浮 (Hover) 在卡片上时显现。
    *   **隐私状态切换**: 
        *   一键切换 `Public` / `Private`。
        *   **安全弹窗**: 切换至 `Private` 时**必须**弹出对话框设置 **解密口令** 与 **提示词**（口令限制输入中文字符，支持明文切换）。已有关联口令的私密转公开时需二次确认。
    *   **编辑 (方案 A)**: 原位编辑模式。点击后卡片 UI 转化为输入框，支持实时保存。
    *   **删除 (垃圾箱)**: 
        *   执行 **软删除 (Soft Delete)**，BB 仅在垃圾箱视图可见。
        *   垃圾箱视图支持 **一键恢复** 或 **手动彻底删除**。
        *   **注意**: 系统不执行自动物理清理，除非管理员主动操作。
*   **搜索系统**: 
    *   支持关键词模糊搜索与 `#标签` 精确匹配。
    *   规则：仅检索已解锁或公开内容。
