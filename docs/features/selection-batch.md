# 功能说明：笔记多选与批量操作 (Selection & Batch Operations)

## 1. 需求背景
为了提升笔记管理的效率，用户需要能够一次性对多个笔记进行操作，而不是逐个处理。核心场景包括：
- 批量清理（删除）笔记。
- 批量归类（添加标签）笔记。

## 2. 交互逻辑
- 激活模式：点击顶栏 "JustMemo" 品牌旁的更多菜单中的“选择笔记”。
- 状态切换：
  - 点击笔记卡片的任何区域或左上角的 Checkbox 均可切换选中状态。
  - 选中时，卡片会有明显的边框高亮。
- 操作栏：进入选择模式后，顶挡搜索框替换为操作工具栏，包含：
  - 选中计数：显示当前已选中的项目数。
  - 批量添加标签：弹出标签选择器。
  - 批量删除：确认后将笔记移入回收站。
  - 重置/取消：清空选中或完全退出模式。

## 3. 架构实现

### 3.1 状态管理 (`SelectionContext`)
采用 React Context 管理全局选择状态，确保 UI 响应一致性：
- `isSelectionMode`: 全局开关。
- `selectedIds`: `Set<string>` 存储选中的 UUID。

### 3.2 UI 组件增强
- `FeedHeader`: 模式分发器。负责根据模式展示不同的 UI 视图。
- `MemoCard`: 交互层。在多选模式下屏蔽了原有的引用和操作按钮，转而捕获全域点击事件用于选中。
- `TagSelectDialog` (NEW): 批量操作专用的对话框。支持从现有标签库选择，也支持即时输入创建新标签。
- `Checkbox` (NEW): 基于 Radix UI 封装的基础勾选组件。

### 3.3 后端 Actions (`src/actions`)
- `batchDeleteMemos(ids)`: 使用 Supabase 的 `.in('id', ids)` 进行批量更新。采用软删除（设置 `deleted_at`）。
- `batchAddTagsToMemos(ids, tags)`: 
  - 先拉取涉及的所有笔记原始标签。
  - 在服务端进行 `Set` 合并，确保标签不重复。
  - 发起批量更新请求。

## 4. 复盘与注意
- 性能：当选中数量极大（如 100+）时，`Set` 操作仍然高效，但批量合并标签的并行请求数量需要优化（目前是 `Promise.all`）。
- 交互冲突：处理好卡片全域点击与 Checkbox 冒泡的关系，确保交互直观。
- 权限：所有批量操作均在 Server Action 层集成了 `isAdmin` 校验，确保安全。
