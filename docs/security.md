# JustMemo 安全与隐私架构

## 1. 隐私策略
*   **物理隔离方案**: 采用服务端 Supabase RPC 校验方案，确保未授权内容物理级不返回。
*   **搜索隔离**: 私密内容对非授权用户在搜索模式下彻底隐身（不返回占位符）。
*   **可见性控制**: 默认 Public，支持 `is_private` 标记。

## 2. 解锁流程 (Unlock Flow)
1.  **视觉屏蔽**: 锁定内容通过 **高斯模糊 (Gaussian Blur)** 针对“占位文本”进行渲染，并展示 **口令提示词 (Hint)**。
2.  **验证机制**: 采用 **Server Action + HttpOnly Cookie** 实现 Hash 校验。
3.  **会话保持与离线**: 用户输入密码成功后，写入加密 Cookie。系统支持在 **Session 内缓存已解密内容** (如本地私有状态)，确保用户在联网解锁后，短时间内离线仍可阅读已解锁的 BB。

## 3. 鉴权逻辑
*   **管理员**: 使用 Supabase Auth (Email/Login) 管理发布、编辑与删除权限。**已登录的管理员自动拥有全站内容（包括私密）的免密查看权**。未登录用户降级为只读模式。
*   **写操作保护**: 开启数据库 RLS (Row Level Security)，物理级限制 `UPDATE` 和 `DELETE` 操作仅限认证的管理员 UID。
*   **访客**: 基于 RPC 函数的口令匹配获取内容。在非搜索模式下仅能看到加密占位；即便解锁后亦仅具备只读权限（不展示管理菜单）。
*   **脱敏同步 (Redacted Sync)**: 全量后台同步接口 (`getAllMemos`) 对私密记录执行物理脱敏（清除 `content` 和 `tags`），防止敏感数据明文驻留在 `localStorage`。
